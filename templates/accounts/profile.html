{% extends "base.html" %}

{% block title %}Your Profile - Brews &amp; Chews{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block main_class %}dashboard-main{% endblock %}

{% block content %}
<section class="dashboard-hero">
    <div>
        <p class="dashboard-eyebrow">Account Center</p>
        <h1 class="dashboard-title">Hi, {{ request.user.first_name|default:request.user.username }}!</h1>
        <p class="dashboard-subtitle">Manage your contact preferences and view a snapshot of your recent café activity.</p>
    </div>
    <a href="{% url 'menu:catalog' %}" class="btn dashboard-cta">Back to menu</a>
</section>

{% if update_success %}
<div class="dashboard-alert" role="status" aria-live="polite">
    Your profile has been updated successfully.
</div>
{% endif %}

<section class="dashboard-section profile-layout" aria-labelledby="profile-details">
    <div class="profile-summary">
        <h2 id="profile-details" class="dashboard-section__title">Account details</h2>
        <dl>
            <div>
                <dt>Username</dt>
                <dd>{{ request.user.username }}</dd>
            </div>
            <div>
                <dt>Email</dt>
                <dd>{{ user_email }}</dd>
            </div>
            <div>
                <dt>Member since</dt>
                <dd>{{ request.user.date_joined|date:"M d, Y" }}</dd>
            </div>
            <div>
                <dt>Last sign-in</dt>
                <dd>
                    {% if request.user.last_login %}
                    {{ request.user.last_login|date:"M d, Y g:i a" }}
                    {% else %}
                    —
                    {% endif %}
                </dd>
            </div>
        </dl>
    </div>
    <div class="profile-form-wrapper">
        <h2 class="dashboard-section__title">Update preferences</h2>
        <form action="" method="post" class="profile-form">
            {% csrf_token %}
            {% for field in form %}
            <div class="profile-form__field">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}
                <p class="profile-form__hint">{{ field.help_text }}</p>
                {% endif %}
                {% for error in field.errors %}
                <p class="profile-form__error">{{ error }}</p>
                {% endfor %}
            </div>
            {% endfor %}
            <button type="submit" class="btn profile-form__submit">Save changes</button>
        </form>
    </div>
</section>

<section class="dashboard-section" aria-labelledby="profile-recent-orders">
    <h2 id="profile-recent-orders" class="dashboard-section__title">Recent orders</h2>
    {% if recent_orders %}
    <ul class="history-list history-list--compact">
        {% for order in recent_orders %}
        <li class="history-card history-card--compact">
            <div class="history-card__header">
                <div>
                    <h3 class="history-card__title">Order #{{ order.pk }}</h3>
                    <p class="history-card__meta">Placed on {{ order.created_at|date:"M d, Y g:i a" }}</p>
                </div>
                <span class="history-card__status history-card__status--{{ order.status }}">{{ order.get_status_display }}</span>
            </div>
            <p class="history-card__summary">Total: ₱{{ order.total|floatformat:2 }}</p>
        </li>
        {% endfor %}
    </ul>
    <a href="{% url 'orders:history' %}" class="btn btn-link">View full history</a>
    {% else %}
    <div class="dashboard-empty">
        <p>No orders yet. Start by exploring the menu.</p>
        <a href="{% url 'menu:catalog' %}" class="btn">Order now</a>
    </div>
    {% endif %}
</section>
{% endblock %}