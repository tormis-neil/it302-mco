{% extends "base.html" %}
{% load static %}

{% block title %}Create Account - Brews & Chews{% endblock %}

{% block main_class %}auth-main{% endblock %}

{% block content %}

<!-- Registration form for new users -->
<section aria-labelledby="signup-title" class="auth-card">
    
    <!-- Page title -->
    <h1 id="signup-title" class="hero-heading auth-title">Create your Brews &amp; Chews account</h1>

    <!-- General error messages -->
    {% if form.non_field_errors %}
    <div class="auth-alert" role="alert">
        {{ form.non_field_errors|join:" " }}
    </div>
    {% endif %}

    <!-- Signup form with client-side validation -->
    <form action="{% url 'accounts:signup' %}" 
          method="post" 
          class="auth-form" 
          novalidate 
          data-signup-form>

        {% csrf_token %}
        
        <!-- Username field -->
        <div class="auth-field">
            <label for="su-username" class="auth-label">Username</label>
            <input id="su-username" 
                   name="username" 
                   type="text" 
                   autocomplete="username" 
                   required 
                   placeholder="Choose a username" 
                   class="auth-input" 
                   value="{{ form.username.value|default_if_none:'' }}">
            
            <!-- Error message container -->
            <p class="auth-error" 
               role="alert" 
               aria-live="polite" 
               aria-atomic="true" 
               data-field-error="username" 
               {% if not form.errors.username %}hidden{% endif %}>
                {{ form.errors.username|join:" " }}
            </p>
        </div>

        <!-- Email field -->
        <div class="auth-field">
            <label for="su-email" class="auth-label">Email</label>
            <input id="su-email" 
                   name="email" 
                   type="email" 
                   autocomplete="email" 
                   required 
                   placeholder="Enter your email" 
                   class="auth-input" 
                   value="{{ form.email.value|default_if_none:'' }}">
            
            <!-- Error message container -->
            <p class="auth-error" 
               role="alert" 
               aria-live="polite" 
               aria-atomic="true" 
               data-field-error="email" 
               {% if not form.errors.email %}hidden{% endif %}>
                {{ form.errors.email|join:" " }}
            </p>
        </div>

        <!-- Password field with strength meter -->
        <div class="auth-field">
            <label for="su-password" class="auth-label">Password</label>
            <input id="su-password" 
                   name="password" 
                   type="password" 
                   autocomplete="new-password" 
                   required 
                   placeholder="Create a password" 
                   class="auth-input" 
                   aria-describedby="password-help">
            
            <!-- Password strength indicator and requirements -->
            <div class="password-guidance" id="password-help">
                
                <!-- Strength meter bar -->
                <div class="password-strength" aria-live="polite">
                    <div class="password-strength-meter" aria-hidden="true">
                        <span class="password-strength-bar" data-strength-bar></span>
                    </div>
                    <p class="password-strength-label" data-strength-label>Strength: Too weak</p>
                </div>
                
                <!-- Requirements checklist -->
                <ul class="password-requirements" aria-label="Password requirements">
                    <li data-requirement="length" data-valid="false">At least 12 characters long</li>
                    <li data-requirement="uppercase" data-valid="false">Contains an uppercase letter</li>
                    <li data-requirement="number" data-valid="false">Includes a number</li>
                    <li data-requirement="special" data-valid="false">Includes a special character (!@#$%^&amp;*)</li>
                </ul>
            </div>
            
            <!-- Error message container -->
            <p class="auth-error" 
               role="alert" 
               aria-live="polite" 
               aria-atomic="true" 
               data-field-error="password" 
               {% if not form.errors.password %}hidden{% endif %}>
                {{ form.errors.password|join:" " }}
            </p>
        </div>

        <!-- Confirm password field -->
        <div class="auth-field">
            <label for="su-confirm" class="auth-label">Confirm Password</label>
            <input id="su-confirm" 
                   name="confirm_password" 
                   type="password" 
                   autocomplete="new-password" 
                   required 
                   placeholder="Re-enter your password" 
                   class="auth-input">
            
            <!-- Error message container -->
            <p class="auth-error" 
               role="alert" 
               aria-live="polite" 
               aria-atomic="true" 
               data-field-error="confirm" 
               {% if not form.errors.confirm_password %}hidden{% endif %}>
                {{ form.errors.confirm_password|join:" " }}
            </p>
        </div>

        <!-- Submit button -->
        <button type="submit" class="btn auth-submit--full">Create Account</button>
    </form>

    <!-- Link to login page -->
    <p class="auth-alt">
        <em>Already have an account?</em> 
        <a href="{% url 'accounts:login' %}" class="links">Sign In</a>
    </p>
</section>

{% endblock %}

<!-- Load password validation JavaScript -->
{% block extra_js %}
<script src="{% static 'js/auth.js' %}" defer></script>
{% endblock %}