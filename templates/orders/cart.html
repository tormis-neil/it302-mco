{% extends "base.html" %}
{% load static %}

{% block title %}Your Cart - Brews &amp; Chews{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block main_class %}dashboard-main{% endblock %}

{% block content %}

<!-- Hero section -->
<section class="dashboard-hero">
    <div>
        <p class="dashboard-eyebrow">Cart Overview</p>
        <h1 class="dashboard-title">Review your selections</h1>
        <p class="dashboard-subtitle">Review your cart and proceed to checkout when ready.</p>
    </div>
    <a href="{% url 'menu:catalog' %}" class="btn dashboard-cta">Back to menu</a>
</section>

<!-- Cart contents (if not empty) -->
{% if cart_items %}

<!-- Cart items table -->
<section class="dashboard-section cart-section" aria-labelledby="cart-items">
    <h2 id="cart-items" class="dashboard-section__title">Items in your cart</h2>

    <div class="cart-table" role="table">

        <!-- Table header -->
        <div class="cart-table__header" role="row">
            <span class="cart-table__cell" role="columnheader">Item</span>
            <span class="cart-table__cell" role="columnheader">Price</span>
            <span class="cart-table__cell" role="columnheader">Quantity</span>
            <span class="cart-table__cell" role="columnheader">Line Total</span>
            <span class="cart-table__cell" role="columnheader">Actions</span>
        </div>

        <!-- Cart items rows -->
        {% for item in cart_items %}
        <div class="cart-table__row" role="row">
            <span class="cart-table__cell cart-table__item" role="cell" data-label="Item">
                <strong>{{ item.menu_item.name }}</strong>
                <small class="cart-table__muted">{{ item.menu_item.category.name }}</small>
            </span>
            <span class="cart-table__cell" role="cell" data-label="Price">₱{{ item.menu_item.base_price|floatformat:2 }}</span>
            <span class="cart-table__cell" role="cell" data-label="Quantity">
                <form method="post" action="{% url 'orders:update_cart_item' item.id %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="{{ item.quantity|add:-1 }}">
                    <button type="submit" class="btn btn-small" {% if item.quantity <= 1 %}disabled{% endif %}>-</button>
                </form>
                <span style="margin: 0 10px;">{{ item.quantity }}</span>
                <form method="post" action="{% url 'orders:update_cart_item' item.id %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="{{ item.quantity|add:1 }}">
                    <button type="submit" class="btn btn-small">+</button>
                </form>
            </span>
            <span class="cart-table__cell" role="cell" data-label="Total">₱{{ item.line_total|floatformat:2 }}</span>
            <span class="cart-table__cell cart-table__actions" role="cell" data-label="Actions">
                <form method="post" action="{% url 'orders:remove_from_cart' item.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link">Remove</button>
                </form>
            </span>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Order summary -->
<section class="dashboard-section cart-summary" aria-labelledby="cart-summary">
    <h2 id="cart-summary" class="dashboard-section__title">Order summary</h2>
    
    <dl class="cart-summary__list">
        <div class="cart-summary__row">
            <dt>Subtotal</dt>
            <dd>₱{{ subtotal|floatformat:2 }}</dd>
        </div>
        <div class="cart-summary__row">
            <dt>Tax (8%)</dt>
            <dd>₱{{ tax|floatformat:2 }}</dd>
        </div>
        <div class="cart-summary__row cart-summary__total">
            <dt>Total</dt>
            <dd>₱{{ total|floatformat:2 }}</dd>
        </div>
    </dl>
    
    <a href="{% url 'orders:checkout' %}" class="btn cart-summary__cta btn-disabled" aria-disabled="true">Checkout (Coming in Phase 2)</a>
</section>

<!-- Empty cart state -->
{% else %}
<div class="dashboard-empty">
    <p>Your cart is currently empty.</p>
    <a href="{% url 'menu:catalog' %}" class="btn">Browse the menu</a>
</div>
{% endif %}

{% endblock %}