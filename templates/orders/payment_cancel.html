{% extends "base.html" %}
{% load static %}

{% block title %}Payment Cancelled - Brews &amp; Chews{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block main_class %}dashboard-main{% endblock %}

{% block content %}

<!-- Hero section -->
<section class="dashboard-hero">
    <div>
        <p class="dashboard-eyebrow">Payment Cancelled</p>
        <h1 class="dashboard-title">Your payment was not completed</h1>
        <p class="dashboard-subtitle">
            {% if can_retry %}
            Don't worry - your order has been saved. You can try again or browse the menu.
            {% else %}
            This order can no longer be modified. Please check your order history for details.
            {% endif %}
        </p>
    </div>
    <a href="{% url 'menu:catalog' %}" class="btn dashboard-cta">Browse Menu</a>
</section>

<!-- Order details -->
<section class="dashboard-section" aria-labelledby="order-details">
    <h2 id="order-details" class="dashboard-section__title">Order Details</h2>

    <div class="checkout-summary" style="max-width: 600px;">
        <!-- Order reference -->
        <div class="cart-summary__row" style="margin-bottom: 1rem;">
            <strong>Order Reference:</strong>
            <span>{{ order.reference_number }}</span>
        </div>

        <!-- Order status -->
        <div class="cart-summary__row" style="margin-bottom: 1rem;">
            <strong>Status:</strong>
            <span class="status-badge status-{{ order.status }}">
                {{ order.get_status_display }}
            </span>
        </div>

        <!-- Items list -->
        <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Items in Order</h3>
        <ul class="checkout-items">
            {% for item in order.items.all %}
            <li class="checkout-items__entry">
                <div>
                    <strong>{{ item.menu_item_name }}</strong>
                    <span class="checkout-items__meta">Qty {{ item.quantity }}</span>
                </div>
                <span>&#8369;{{ item.line_total|floatformat:2 }}</span>
            </li>
            {% endfor %}
        </ul>

        <!-- Totals -->
        <dl class="cart-summary__list">
            <div class="cart-summary__row">
                <dt>Subtotal</dt>
                <dd>&#8369;{{ order.subtotal|floatformat:2 }}</dd>
            </div>
            <div class="cart-summary__row">
                <dt>Tax (8%)</dt>
                <dd>&#8369;{{ order.tax|floatformat:2 }}</dd>
            </div>
            <div class="cart-summary__row cart-summary__total">
                <dt>Total</dt>
                <dd>&#8369;{{ order.total|floatformat:2 }}</dd>
            </div>
        </dl>
    </div>

    <!-- Action buttons -->
    {% if can_retry %}
    <div style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
        <form method="post" action="{% url 'orders:retry_payment' order.pk %}" style="margin: 0;">
            {% csrf_token %}
            <button type="submit" class="btn" style="background: #4caf50; color: white; border: none; padding: 0.75rem 1.5rem; font-weight: 600;">
                Retry Payment
            </button>
        </form>
        <a href="{% url 'orders:history' %}" class="btn" style="background: #2c1810; color: white; padding: 0.75rem 1.5rem; text-decoration: none;">
            View in Order History
        </a>
        <a href="{% url 'menu:catalog' %}" class="btn" style="background: #ffffff; border: 2px solid #2c1810; color: #2c1810; padding: 0.75rem 1.5rem; text-decoration: none;">
            Continue Shopping
        </a>
    </div>

    <div style="margin-top: 2rem; padding: 1.5rem; background: #fff8e1; border-radius: 8px; max-width: 600px; color: #5d4037;">
        <h3 style="margin-bottom: 0.5rem; color: #4e342e;">Need help?</h3>
        <p style="color: #6d4c41;">If you're having trouble completing your payment, please try the following:</p>
        <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: #5d4037;">
            <li>Check your internet connection</li>
            <li>Ensure your payment method has sufficient funds</li>
            <li>Try a different payment method (Card, GCash, or PayMaya)</li>
            <li>Contact your bank if the issue persists</li>
        </ul>
    </div>
    {% else %}
    <div style="margin-top: 2rem;">
        <a href="{% url 'orders:history' %}" class="btn" style="background: #2c1810; color: white; padding: 0.75rem 1.5rem; text-decoration: none;">
            View Order History
        </a>
    </div>
    {% endif %}
</section>

{% endblock %}
