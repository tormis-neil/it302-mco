{% extends "base.html" %}
{% load static %}

{% block title %}Payment Cancelled - Brews &amp; Chews{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block main_class %}dashboard-main{% endblock %}

{% block content %}

<!-- Hero section -->
<section class="dashboard-hero">
    <div>
        <p class="dashboard-eyebrow">Payment Cancelled</p>
        <h1 class="dashboard-title">Your payment was not completed</h1>
        <p class="dashboard-subtitle">
            {% if can_retry %}
            Don't worry - your order has been saved. You can try again or browse the menu.
            {% else %}
            This order can no longer be modified. Please check your order history for details.
            {% endif %}
        </p>
    </div>
    <a href="{% url 'menu:catalog' %}" class="btn dashboard-cta">Back to Menu</a>
</section>

<!-- Order details card -->
<section class="dashboard-section" aria-labelledby="order-details">
    <h2 id="order-details" class="dashboard-section__title">Order Details</h2>

    <div class="history-card">
        <!-- Order header with status -->
        <header class="history-card__header">
            <div class="history-card__header-info">
                <h3 class="history-card__title">Order {{ order.reference_number }}</h3>
                <p class="history-card__meta">
                    Placed on {{ order.created_at|date:"M d, Y g:i a" }}
                </p>
            </div>
            <span class="history-card__status history-card__status--{{ order.status }}">
                {{ order.get_status_display }}
            </span>
        </header>

        <!-- Order items list -->
        <ul class="history-card__items">
            {% for item in order.items.all %}
            <li>
                <strong>{{ item.menu_item_name }}</strong>
                <span class="history-card__items-meta">Qty {{ item.quantity }}</span>
                <span>&#8369;{{ item.line_total|floatformat:2 }}</span>
            </li>
            {% endfor %}
        </ul>

        <!-- Order footer with totals -->
        <footer class="history-card__footer">
            <dl>
                <div>
                    <dt>Subtotal</dt>
                    <dd>&#8369;{{ order.subtotal|floatformat:2 }}</dd>
                </div>
                <div>
                    <dt>Tax (8%)</dt>
                    <dd>&#8369;{{ order.tax|floatformat:2 }}</dd>
                </div>
                <div class="history-card__total">
                    <dt>Total</dt>
                    <dd>&#8369;{{ order.total|floatformat:2 }}</dd>
                </div>
            </dl>
        </footer>
    </div>
</section>

<!-- Help section (for retry-able orders) -->
{% if can_retry %}
<section class="dashboard-section" aria-labelledby="need-help">
    <h2 id="need-help" class="dashboard-section__title">Need help?</h2>

    <div class="history-card">
        <p class="help-intro">If you're having trouble completing your payment, please try the following:</p>
        <ul class="help-list">
            <li>Check your internet connection</li>
            <li>Ensure your payment method has sufficient funds</li>
            <li>Try a different payment method (Card, GCash, or PayMaya)</li>
            <li>Contact your bank if the issue persists</li>
        </ul>
    </div>
</section>
{% endif %}

<!-- Action buttons -->
<div class="payment-actions">
    {% if can_retry %}
    <form method="post" action="{% url 'orders:retry_payment' order.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-pay">Retry Payment</button>
    </form>
    {% endif %}
    <a href="{% url 'menu:catalog' %}" class="btn btn-secondary">Back to Menu</a>
    <a href="{% url 'orders:history' %}" class="btn">View Order History</a>
</div>

{% endblock %}
